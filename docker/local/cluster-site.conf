<VirtualHost *:80>

    RewriteEngine on

    # Welder

    RewriteCond %{REQUEST_URI} /proxy/[^/]*/[^/]*/welder/.* [NC]
    RewriteRule /proxy/[^/]*/[^/]*/welder/(.*) http://127.0.0.1:8080/$1 [P,L]

    # Jupyter (legacy path)

    RewriteCond %{HTTP:Upgrade} =websocket
    RewriteCond %{REQUEST_URI} /notebooks/[^/]*/[^/]*/.* [NC]
    RewriteRule .*     ws://127.0.0.1:8000%{REQUEST_URI}  [P,L]

    RewriteCond %{HTTP:Upgrade} !=websocket
    RewriteCond %{REQUEST_URI} /notebooks/[^/]*/[^/]*/.* [NC]
    RewriteRule .*     http://127.0.0.1:8000%{REQUEST_URI}  [P,L]

    ProxyPass / http://127.0.0.1:8000/ retry=10
    ProxyPassReverse / http://127.0.0.1:8000/
</VirtualHost>
