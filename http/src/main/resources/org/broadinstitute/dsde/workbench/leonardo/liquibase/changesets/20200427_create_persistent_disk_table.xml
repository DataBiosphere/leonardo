<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog logicalFilePath="leonardo" xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet logicalFilePath="leonardo" author="rtitle" id="persistent-disk-table">
        <sql>
            CREATE TABLE PERSISTENT_DISK (
                id BIGINT AUTO_INCREMENT PRIMARY KEY,
                googleProject VARCHAR(255) NOT NULL,
                zone VARCHAR(255) NOT NULL,
                name VARCHAR(255) NOT NULL,
                googleId VARCHAR(255),
                samResourceId VARCHAR(255) NOT NULL,
                status VARCHAR(255) NOT NULL,
                creator VARCHAR(255) NOT NULL,
                createdDate TIMESTAMP(6) NOT NULL,
                destroyedDate TIMESTAMP(6) NOT NULL DEFAULT "1970-01-01 00:00:01.000000",
                dateAccessed TIMESTAMP(6) NOT NULL DEFAULT "1970-01-01 00:00:01.000000",
                sizeGb INT NOT NULL,
                type VARCHAR(255) NOT NULL,
                blockSizeBytes INT NOT NULL,

                UNIQUE (googleProject, name, destroyedDate),
                INDEX IDX_PERSISTENT_DISK_STATUS (status)
            );
        </sql>
    </changeSet>

    <changeSet logicalFilePath="leonardo" author="rtitle" id="update-label-table">
        <dropForeignKeyConstraint baseTableName="LABEL" constraintName="FK_CLUSTER_ID" />
        <dropUniqueConstraint tableName="LABEL" constraintName="IDX_LABEL_UNIQUE" />
        <renameColumn tableName="LABEL" oldColumnName="clusterId" newColumnName="resourceId" columnDataType="VARCHAR(254)" />
        <addColumn tableName="LABEL">
            <column name="resourceType" type="VARCHAR(254)">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <addUniqueConstraint tableName="LABEL" columnNames="resourceId, resourceType, key" constraintName="IDX_LABEL_UNIQUE" />
    </changeSet>
</databaseChangeLog>
